<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Card√°pio - L.V.G.R</title>
  <link rel="shortcut icon" href="lua.ico" type="image/x-icon">
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Font Awesome para o √≠cone da lixeira -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body class="bg-[#0e0e0e] text-[#ffffff]">

<header class="bg-[#ff5400] text-center py-6">
  <img src="img/hamb-1.png" alt="foto" class="w-32 h-32 mx-auto rounded-full shadow-lg border-4 border-white" />
  <h1 class="text-4xl font-semibold">L.V.G.R</h1>
  <p class="text-sm mt-4">Fa√ßa seu pedido com carinho üíö</p>
</header>

<!-- Se√ß√£o do Card√°pio -->
<section class="max-w-4xl mx-auto py-10 px-4">
  <h2 class="text-2xl text-center mb-6">Nosso Card√°pio</h2>
  <div id="menu-container" class="grid grid-cols-1 md:grid-cols-2 gap-6">
    <!-- Itens ser√£o inseridos via JavaScript -->
  </div>
</section>

<!-- Se√ß√£o do Carrinho -->
<section class="max-w-4xl mx-auto px-4 pb-10">
  <h2 class="text-2xl font-semibold text-center mb-4">Carrinho</h2>
  <table class="w-full bg-white rounded shadow text-center text-[#ff5400]">
    <thead class="bg-[#ff5400] text-white">
      <tr>
        <th class="py-2">Item</th>
        <th>Quantidade</th>
        <th>Pre√ßo</th>
        <th>A√ß√µes</th>
      </tr>
    </thead>
    <tbody id="carrinho-corpo">
      <!-- Itens do carrinho ser√£o inseridos aqui -->
    </tbody>
  </table>
  <p id="total-carrinho" class="text-right mt-2 font-bold">Total: R$ 0,00</p>
  <div class="text-center mt-4">
    <button id="confirmar-pedido" class="bg-green-600 text-white px-6 py-2 rounded hover:bg-green-700">
      Confirmar Pedido
    </button>
  </div>
</section>

<script src="api.js"></script>
<script>
  // ----- Carrinho (armazenado em mem√≥ria e sincronizado com localStorage) -----
  let carrinho = {};

  // Carregar carrinho do localStorage, se existir
  if (localStorage.getItem('catcafe-carrinho')) {
    carrinho = JSON.parse(localStorage.getItem('catcafe-carrinho'));
  }

  // ----- Fun√ß√µes auxiliares -----
  function salvarCarrinho() {
    localStorage.setItem('catcafe-carrinho', JSON.stringify(carrinho));
  }

  function formatarPreco(valor) {
    return 'R$ ' + valor.toFixed(2).replace('.', ',');
  }

  // ----- Renderizar card√°pio (cria os cards dinamicamente a partir da API) -----
  async function renderizarCardapio() {
    const container = document.getElementById('menu-container');
    container.innerHTML = 'Carregando card√°pio...'; // Feedback para o usu√°rio

    const itensCardapio = await getProducts(); // Busca os produtos da API

    container.innerHTML = ''; // Limpa o container antes de inserir os novos itens

    if (itensCardapio.length === 0) {
      container.innerHTML = '<p class="text-center col-span-full">N√£o foi poss√≠vel carregar o card√°pio. Tente novamente mais tarde.</p>';
      return;
    }

    itensCardapio.forEach(item => {
      const card = document.createElement('div');
      card.className = 'bg-[#ffffff] text-[#ff5400] p-4 rounded-xl shadow';

      card.innerHTML = `
        <img src="${item.imgUrl}" alt="${item.nome}" class="w-full h-40 object-cover rounded-md mb-4" />
        <h3 class="text-xl font-bold">${item.nome}</h3>
        <p class="text-sm text-gray-600">${item.descricao || ''}</p>
        <p class="text-lg mt-2">${formatarPreco(item.price)}</p>
        <button class="adicionar-btn mt-2 bg-green-600 text-white px-4 py-1 rounded hover:bg-green-700"
                data-nome="${item.nome}"
                data-preco="${item.price}">
          Adicionar üõí
        </button>
      `;

      container.appendChild(card);
    });

    // Adiciona eventos aos bot√µes "Adicionar"
    document.querySelectorAll('.adicionar-btn').forEach(btn => {
      btn.addEventListener('click', (e) => {
        const nome = e.target.dataset.nome;
        const preco = parseFloat(e.target.dataset.preco);
        adicionarAoCarrinho(nome, preco);
      });
    });
  }

  // ----- Fun√ß√µes de manipula√ß√£o do carrinho -----
  function adicionarAoCarrinho(nome, preco) {
    if (carrinho[nome]) {
      carrinho[nome].quantidade++;
    } else {
      carrinho[nome] = { quantidade: 1, preco: preco };
    }
    salvarCarrinho();
    renderizarCarrinho();
  }

  function incrementarItem(nome) {
    if (carrinho[nome]) {
      carrinho[nome].quantidade++;
      salvarCarrinho();
      renderizarCarrinho();
    }
  }

  function decrementarItem(nome) {
    if (carrinho[nome]) {
      carrinho[nome].quantidade--;
      if (carrinho[nome].quantidade <= 0) {
        delete carrinho[nome];
      }
      salvarCarrinho();
      renderizarCarrinho();
    }
  }

  function removerItem(nome) {
    if (carrinho[nome]) {
      delete carrinho[nome];
      salvarCarrinho();
      renderizarCarrinho();
    }
  }

  // ----- Renderizar a tabela do carrinho -----
  function renderizarCarrinho() {
    const tbody = document.getElementById('carrinho-corpo');
    tbody.innerHTML = '';
    let total = 0;

    for (let nome in carrinho) {
      const item = carrinho[nome];
      const subtotal = item.quantidade * item.preco;
      total += subtotal;

      const tr = document.createElement('tr');
      tr.className = 'border-t';

      tr.innerHTML = `
        <td class="py-2">${nome}</td>
        <td>${item.quantidade}</td>
        <td>${formatarPreco(subtotal)}</td>
        <td class="space-x-2">
          <button class="incrementar-btn text-blue-600 hover:text-blue-800" data-nome="${nome}">+</button>
          <button class="decrementar-btn text-yellow-600 hover:text-yellow-800" data-nome="${nome}">-</button>
          <button class="remover-btn text-red-600 hover:text-red-800" data-nome="${nome}">
            <i class="fas fa-trash-alt"></i> <!-- √çcone lixeira -->
          </button>
        </td>
      `;

      tbody.appendChild(tr);
    }

    // Se o carrinho estiver vazio
    if (Object.keys(carrinho).length === 0) {
      const tr = document.createElement('tr');
      tr.innerHTML = '<td colspan="4" class="py-4 text-gray-500">Carrinho vazio</td>';
      tbody.appendChild(tr);
    }

    // Atualiza o total
    document.getElementById('total-carrinho').innerText = `Total: ${formatarPreco(total)}`;

    // Adiciona eventos aos bot√µes do carrinho
    document.querySelectorAll('.incrementar-btn').forEach(btn => {
      btn.addEventListener('click', (e) => {
        const nome = e.target.dataset.nome;
        incrementarItem(nome);
      });
    });

    document.querySelectorAll('.decrementar-btn').forEach(btn => {
      btn.addEventListener('click', (e) => {
        const nome = e.target.dataset.nome;
        decrementarItem(nome);
      });
    });

    document.querySelectorAll('.remover-btn').forEach(btn => {
      btn.addEventListener('click', (e) => {
        // 
        const nome = e.target.closest('button').dataset.nome;
        removerItem(nome);
      });
    });
  }

  // ----- Finalizar pedido -----
  document.getElementById('confirmar-pedido').addEventListener('click', () => {
    if (Object.keys(carrinho).length === 0) {
      alert('Seu carrinho est√° vazio!');
      return;
    }

    let resumo = 'Pedido confirmado:\n';
    let total = 0;
    for (let nome in carrinho) {
      const item = carrinho[nome];
      const subtotal = item.quantidade * item.preco;
      resumo += `${nome} - ${item.quantidade}x = ${formatarPreco(subtotal)}\n`;
      total += subtotal;
    }
    resumo += `\nTotal: ${formatarPreco(total)}`;
    alert(resumo);

    // Opcional: limpar carrinho ap√≥s confirmar
    // carrinho = {};
    // salvarCarrinho();
    // renderizarCarrinho();
  });

  // ----- Inicializa√ß√£o -----
  renderizarCardapio();
  renderizarCarrinho();
</script>

</body>
</html>