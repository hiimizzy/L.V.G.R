<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>L.V.G.R · acesso</title>
  <link rel="shortcut icon" href="lua.ico" type="image/x-icon">
  <!-- Tailwind + Font Awesome -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <link rel="stylesheet" href="style.css">
  <link rel="shortcut icon" href="img/lua.ico" type="image/x-icon">
</head>

<body class="bg-[#0e0e0e] text-[#0e0e0e] min-h-screen flex items-center justify-center p-4 font-sans">

  <div class="bg-white/90 backdrop-blur-sm shadow-2xl rounded-3xl max-w-md w-full p-8 border border-white/30">

    <!-- cabeçalho com ícone personalizado: lua -->
    <div class="text-center space-y-3">
      <div
        class="relative inline-flex items-center justify-center w-24 h-24 rounded-full bg-[#0e0e0e]/20 text-[#000000] shadow-md">
        <!-- lua grande -->
        <i class="fas fa-moon text-5xl"></i>
      </div>
      <h1 class="text-3xl font-bold tracking-tight">L.V.G.R</h1>
      <p class="text-[#5d3f31]/80 text-sm">Preparamos sua experiência · Escolha seu perfil</p>
    </div>

    <!-- abas: login / cadastro -->
    <div class="flex mt-8 bg-gray-100 p-1 rounded-full">
      <button id="tabLoginBtn"
        class="tab-button active w-1/2 py-2 text-sm font-medium hover:bg-[#ff5400] rounded-full transition-all duration-200 bg-white shadow"
        data-tab="login">
        <i class="fas fa-sign-in-alt mr-2"></i>Entrar
      </button>
      <button id="tabRegisterBtn"
        class="tab-button w-1/2 py-2 text-sm font-medium hover:bg-[#ff5400] rounded-full transition-all duration-200 text-gray-600 hover:text-gray-900"
        data-tab="register">
        <i class="fas fa-user-plus mr-2"></i>
      </button>
    </div>

    <!-- formulário de LOGIN -->
    <div id="loginForm" class="tab-content mt-6 space-y-4">
      <form>
        <!-- Acessar a conta -->
        <div class="relative">
          <i class="fas fa-envelope absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 text-sm"></i>
          <input type="email" id="login-email" placeholder="Seu e-mail" required
            class="w-full pl-10 pr-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-[#A1887F] focus:border-transparent outline-none transition">
        </div>
        <div class="relative">
          <i class="fas fa-lock absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 text-sm"></i>
          <input type="password" id="login-password" placeholder="Senha" required
            class="w-full pl-10 pr-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-[#A1887F] focus:border-transparent outline-none transition">
        </div>

        <div class="flex items-center justify-between text-sm">
          <label class="flex items-center gap-2 text-gray-600">
            <input type="checkbox" class="rounded border-gray-300"> Lembrar
          </label>
          <!-- <a href="#" class="text-[#8D6E63] hover:underline">Esqueceu a senha?</a> -->
        </div>

        <button type="submit"
          class="w-full bg-[#0e0e0e] hover:bg-[#ff5400] text-white font-semibold py-3 rounded-xl transition-all shadow-md hover:shadow-lg flex items-center justify-center gap-2">
          <i class="fas fa-arrow-right-to-bracket"></i> Acessar
        </button>

        <!-- Mensagem de erro para o login -->
        <div id="login-error" class="text-red-600 text-sm text-center pt-2 font-semibold"></div>
      </form>
    </div>

    <!-- formulário de CADASTRO (garçom/cozinha/admin) -->
    <div id="registerForm" class="tab-content tab-hidden mt-6 space-y-4">
      <form>
        <!-- papel (cliente / admin) -->
        <div class="role-option flex gap-3 justify-center mb-4">
          <div>
            <input type="radio" name="loginRole" id="loginCliente" value="cliente" checked>
            <label for="loginCliente"><i class="fas fa-user"></i> Garçom</label>
          </div>
          <div>
            <input type="radio" name="loginRole" id="loginAdmin" value="admin">
            <label for="loginAdmin"><i class="fas fa-user-cog"></i> Admin</label>
          </div>
          <div>
            <input type="radio" name="loginRole" id="loginCliente" value="cliente" checked>
            <label for="loginCliente"><i class="fas fa-user"></i>Cozinha</label>
          </div>
        </div>

        <div class="relative">
          <i class="fas fa-envelope absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 text-sm"></i>
          <input type="email" id="register-email" placeholder="E-mail" required
            class="w-full pl-10 pr-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-[#A1887F] focus:border-transparent outline-none transition">
        </div>
        <div class="relative">
          <i class="fas fa-lock absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 text-sm"></i>
          <input type="password" placeholder="Senha" id="register-password" required
            class="w-full pl-10 pr-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-[#A1887F] focus:border-transparent outline-none transition">
        </div>
        <div class="relative">
          <i class="fas fa-lock absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 text-sm"></i>
          <input type="password" placeholder="Confirmar Senha" id="register-confirm-password" required
            class="w-full pl-10 pr-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-[#A1887F] focus:border-transparent outline-none transition">
        </div>

        <!-- termos -->
        <div class="flex items-start gap-2 text-sm text-gray-600">
          <input type="checkbox" class="mt-1 rounded border-gray-300" required>
          <span>Aceito os <a href="#" class="text-[#8D6E63] underline">termos de uso</a> e políticas de
            privacidade.</span>
        </div>
        <!--Botão criar conta-->
        <button type="submit"
          class="w-full bg-[#0e0e0e] hover:bg-[#ff5400] text-white font-semibold py-3 rounded-xl transition-all shadow-md hover:shadow-lg flex items-center justify-center gap-2">
          <i class="fas fa-user-check"></i> Criar conta
        </button>
      </form>
    </div>

    <!-- Firebase -->
    <script type="module">
      // Import the functions you need from the SDKs you need
      import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
      import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-auth.js";
      // Importa a configuração de um arquivo separado e seguro
      import { firebaseConfig } from './firebase-config.js';

      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);

      // --- VERIFICA SE O USUÁRIO JÁ ESTÁ LOGADO ---
      // Isso impede que um usuário logado veja a página de login novamente.
      onAuthStateChanged(auth, (user) => {
        if (user) {
          // O usuário está logado, então é redirecionado para a página principal.
          // Isso acontece se ele tentar acessar /login.html diretamente ou usar o botão "voltar" do navegador.
          console.log('Usuário já logado, redirecionando...', user.email);
          // Como não sabemos a "role" (admin/cliente) aqui, redirecionamos para uma página padrão.
          window.location.href = 'cardapio_cliente.html';
        }
        // Se não houver usuário, a página de login continua a ser exibida normalmente.
      });

      // --- LÓGICA DAS ABAS (TABS) ---
      const tabLoginBtn = document.getElementById('tabLoginBtn');
      const tabRegisterBtn = document.getElementById('tabRegisterBtn');
      const loginFormEl = document.getElementById('loginForm');
      const registerFormEl = document.getElementById('registerForm');

      function setActiveTab(tabId) {
        loginFormEl.classList.add('tab-hidden');
        registerFormEl.classList.add('tab-hidden');

        if (tabId === 'login') {
          loginFormEl.classList.remove('tab-hidden');
          tabLoginBtn.classList.add('bg-white', 'shadow');
          tabRegisterBtn.classList.remove('bg-white', 'shadow');
          tabRegisterBtn.classList.add('text-gray-600');
        } else {
          registerFormEl.classList.remove('tab-hidden');
          tabRegisterBtn.classList.add('bg-white', 'shadow');
          tabLoginBtn.classList.remove('bg-white', 'shadow');
          tabLoginBtn.classList.add('text-gray-600');
        }
      }

      tabLoginBtn.addEventListener('click', () => setActiveTab('login'));
      tabRegisterBtn.addEventListener('click', () => setActiveTab('register'));
      setActiveTab('login'); // Inicializa a aba de login como ativa

      // --- LÓGICA DE AUTENTICAÇÃO ---
      // Formulário de Login
      const loginForm = loginFormEl.querySelector('form');
      const loginErrorDiv = document.getElementById('login-error');

      loginForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const email = document.getElementById('login-email').value;
        const password = document.getElementById('login-password').value;

        signInWithEmailAndPassword(auth, email, password)
          .then((userCredential) => {
            console.log("Login bem-sucedido:", userCredential.user);
            loginErrorDiv.textContent = ''; // Limpa qualquer erro anterior
            
            // Redireciona com base no e-mail
            if (email.includes('@garcom')) {
              window.location.href = 'cardapio_garcom.html';
            } else if (email.includes('@admin')) {
              window.location.href = 'admin.html';
            } else if (email.includes('@cozinha')) {
              window.location.href = 'cozinha.html';
            }
            else {
              window.location.href = 'cardapio_cliente.html?mesa=1'; 
            }
          })
          .catch((error) => {
            console.error("Erro no login:", error);
            // Em vez de um alerta, exibe a mensagem no formulário
            if (error.code === 'auth/invalid-credential' || error.code === 'auth/user-not-found' || error.code === 'auth/wrong-password') {
              loginErrorDiv.textContent = 'E-mail ou senha inválidos. Tente novamente.';
            } else {
              loginErrorDiv.textContent = 'Ocorreu um erro inesperado. Tente mais tarde.';
            }
          });
      });

      // Formulário de Cadastro
      const registerForm = registerFormEl.querySelector('form');
      registerForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const email = document.getElementById('register-email').value;
        const password = document.getElementById('register-password').value;
        const confirmPassword = document.getElementById('register-confirm-password').value;

        if (password !== confirmPassword) {
          alert('As senhas não coincidem. Tente novamente.');
          return;
        }

        createUserWithEmailAndPassword(auth, email, password)
          .then((userCredential) => {
            console.log("Usuário cadastrado com sucesso:", userCredential.user);
            alert('Conta criada com sucesso! Agora você pode fazer o login.');
            setActiveTab('login'); // Muda para a aba de login
            registerForm.reset(); // Limpa o formulário de cadastro
          })
          .catch((error) => {
            console.error("Erro no cadastro:", error);
            alert(`Erro ao criar conta: ${error.message}`);
          });
      });
    </script>
</body>

</html>
